<!--
-    Copyright (c) UChicago Argonne, LLC. All rights reserved.
-
-    Copyright UChicago Argonne, LLC. This software was produced
-    under U.S. Government contract DE-AC02-06CH11357 for Argonne National
-    Laboratory (ANL), which is operated by UChicago Argonne, LLC for the
-    U.S. Department of Energy. The U.S. Government has rights to use,
-    reproduce, and distribute this software.  NEITHER THE GOVERNMENT NOR
-    UChicago Argonne, LLC MAKES ANY WARRANTY, EXPRESS OR IMPLIED, OR
-    ASSUMES ANY LIABILITY FOR THE USE OF THIS SOFTWARE.  If software is
-    modified to produce derivative works, such modified software should
-    be clearly marked, so as not to confuse it with the version available
-    from ANL.
-
-    Additionally, redistribution and use in source and binary forms, with
-    or without modification, are permitted provided that the following
-    conditions are met:
-
-        * Redistributions of source code must retain the above copyright
-          notice, this list of conditions and the following disclaimer.
-
-        * Redistributions in binary form must reproduce the above copyright
-          notice, this list of conditions and the following disclaimer in
-          the documentation and/or other materials provided with the
-          distribution.
-
-        * Neither the name of UChicago Argonne, LLC, Argonne National
-          Laboratory, ANL, the U.S. Government, nor the names of its
-          contributors may be used to endorse or promote products derived
-          from this software without specific prior written permission.
-
-    THIS SOFTWARE IS PROVIDED BY UChicago Argonne, LLC AND CONTRIBUTORS
-    AS IS AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
-    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
-    FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL UChicago
-    Argonne, LLC OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
-    INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
-    BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
-    LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
-    CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
-    LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
-    ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
-    POSSIBILITY OF SUCH DAMAGE.
-->
<!DOCTYPE html>
{% from "__autoindex__/macros.html" import thead
with context %}
<!--This is how you comment-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initialscale=1" name="viewport">
    <title>Scandataproc</title>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="/static/bootstrap.min.js"></script>
    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <link rel="stylesheet" href="/static/bootstrap-theme.min.css">
    <link rel="stylesheet" href="/static/bootstrap.min.css">
    <link rel="stylesheet" href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap3-dialog/1.34.7/js/bootstrap-dialog.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap3-dialog/1.34.7/css/bootstrap-dialog.min.css">
    <link href="/static/format/navigator.css" rel="stylesheet">
    <script type="text/javascript" src="/static/format/select.js"></script>
    <link href="/static/format/teststyle.css" rel="stylesheet">
    <script type="text/javascript" src="/static/mpld3.v0.2.js"></script>


</head>
<body role="document">
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button class="navbar-toggle collapsed" aria-controls="navbar" aria-expanded="false" data-target="#navbar"
                    data-toggle="collapse" type="button">
                <span class="sr-only">
                    Toggle navigation
                </span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="login">
                Scandataproc
            </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                {% if user.isAdmin == 1 %}
                <li>
                    <a href="admin">
                        Admin
                    </a>
                </li>
                {% endif %}
                <li>
                    <a href="profile">
                        Profile
                    </a>
                </li>
                <li>
                    <a href="upload">
                        Manage Files
                    </a>
                </li>
                <li>
                    <a href="select">
                        Select Session
                    </a>
                </li>
                <li class="active">
                    <a href="data">
                        Format
                    </a>
                </li>
                <li>
                    <a href="process">
                        Process
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>
<div id="fileModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Choose a File</h4>
            </div>
            <div class="modal-body">
                {% block header %}{% endblock %}
                {% block table %}
                <table>
                    <thead class="fixedHead">
                        {{ thead() }}
                    </thead>
                    <tbody class="scrollable">
                        {% if data %}
                            {% for post in data %}
                                {% set auths = post.authed.split(',') %}
                                {% for aID in auths %}
                                    {% if aID|int() == user.get_id()|int() %}
                                        <tr class="item fixedHead" ondblclick="moveFile()">
                                            <td class="name" colspan="2" id="{{ post.id }}">
                                                {%- if post.name == ".." -%}
                                                Parent folder
                                                {%- else -%}
                                                {{ post.name }}
                                                {%- endif -%}
                                            </a></td>
                                            <td class="modified">
                                                <time datetime="{{ post.modified }}">{{ post.modified }}</time>
                                            </td>
                                            <td class="size">
                                                {% if post.size %}
                                                {{ post.size }}
                                                {% else %}
                                                -
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endif %}
                                {% endfor %}
                            {% endfor %}
                        {% endif %}
                    </tbody>
                </table>
                {% endblock %}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<div id="ssModal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Save Session As</h4>
            </div>
            <div class="ssModalBody">
                <div class="col-xs-6">
                    <br/>
                    <br/>
                    <br/>
                    <label for="ssName">Name:</label>
                    <input type="text" class="form-control" id="ssName">
                </div>
                <div class="col-xs-6">
                    <label for="ssComment">Comment:</label>
                    <textarea class="form-control" rows="5" id="ssComment"></textarea>
                </div>
            </div>
            <div class="ssModalFooter">
                <div class="col-xs-6">
                    <span class="centerBlock">
                        <button type="button" onclick="saveSes()" class="btn btn-primary btn-default" data-dismiss="modal">Save</button>
                    </span>
                </div>
                <div class="col-xs-6">
                    <span class="centerBlock">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="pull-right margin-info">
    <p class="margin-text" align="right">Logged in as <a href="/profile">{{ user.username }}</a>
        <br/>
        <a href="/db">Logbook</a>
        <br/>
        <a href="/logout">Logout</a>
        <br/>
    </p>
</div>
<div class="text-center">
    <div class="allCols">
        <div class="form-group">
            <div class="selectGroup">
                <div class="text-center">
                    <div class="sessionName">
                        <b class="sessionText" id="sesName">{{ ses }}</b>
                    </div>
                </div>
                <div class="text-center">
                    <div class="botSelGroup">
                        <div class="floatL addDropGroup">
                            <div class="plusBtn">
                                <button type="button" class="btn btn-primary btn-md" data-toggle="modal" data-target="#fileModal">
                                    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                                </button>
                            </div>
                            <div class="minusBtn">
                                <button type="button" class="btn btn-primary btn-md" onclick="deleteCmeta()">
                                    <span class="glyphicon glyphicon-minus" aria-hidden="true"></span>
                                </button>
                            </div>
                        </div>
                        <div class="floatL selectorGroup">
                                <label for="sel1">Select files to view:</label>
                                <select multiple class="form-control selector" id="sel1"></select>
                        </div>
                        <div class="floatL commentGroup">
                            <label for="comment">Comment:</label>
                            <textarea class="form-control" rows="5" id="comment" name="comment"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="inline">
                <div class="AEGroup">
                    <label for="againstE">Plot against</label>
                    <button id="againstE" type="button" class="btn btn-default dropdown-toggle setSize" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">Point #<span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu aeDrop">
                        <li><a onclick="setAE(event)">Point #</a></li>
                        <li><a onclick="setAE(event)">Energy</a></li>
                        <li><a onclick="setAE(event)">Energy xtal</a></li>
                        <li><a onclick="setAE(event)">Energy xtal w/ T corr.</a></li>
                    </ul>
                </div>
                <div class="unitGroup">
                    <label for="unitBtn">Unit</label>
                    <button id="unitBtn" type="button" class="btn btn-default dropdown-toggle setSize" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false">meV<span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu unitDrop">
                        <li><a onclick="setUnit(event)">meV</a></li>
                        <li><a onclick="setUnit(event)">keV</a></li>
                    </ul>
                </div>
                <div class="logBtn">
                    <button type="button" onclick="log()" class="btn btn-primary btn-sm" id="logbtn">
                        Add to Logbook
                    </button>
                    <span class="addText">
                        <p id="log_add">
                        </p>
                    </span>
                </div>
            </div>
            <div class="floatClear"></div>
            <form id="meta-form" method=post action="" remote="true">
                <div class="formVariables">
                    <input type="hidden" name="idnum" id="idnum">
                    <input type="hidden" name="agaE" id="agaE" value="{{ againstE }}">
                    <input type="hidden" name="unit" id="unit">
                    <input type="hidden" name="outType" id="outType">
                    <input type="hidden" name="cordData" id="cordData">
                    <input type="hidden" name="session" id="session">
                    <div id="metaForm_id">
                        <br/>
                        <br/>
                        <br/>
                        <div>
                            <span class="pull-left">
                                {{ form.ebool }}
                            </span>
                            <label style="width:300px;">{{ form.energy.label }}</label>
                            {{ form.energy }}
                        </div>
                        <div class="floatClear"></div>
                        <div>
                            <span class="pull-left">
                                {{ form.ecbool }}
                            </span>
                            <label class="pull-left" style="width:300px;">{{ form.energyCalc.label }}</label>
                            From xtal angles
                        </div>
                        <div class="floatClear"></div>
                        <div>
                            <span class="pull-left">
                                {{ form.etcbool }}
                            </span>
                            <label class="pull-left" style="width:300px;">{{ form.energyTempCalc.label }}</label>
                            From xtal angles & temps
                        </div>
                        <div class="floatClear"></div>
                        <div>
                            <span class="pull-left">
                                {{ form.a1bool }}
                            </span>
                            <label style="width:300px;">{{ form.xtal1A.label }}</label>
                            {{ form.xtal1A }}
                        </div>
                        <div class="floatClear"></div>
                        <div>
                            <span class="pull-left">
                                {{ form.a2bool }}
                            </span>
                            <label style="width:300px;">{{ form.xtal2A.label }}</label>
                            {{ form.xtal2A }}
                        </div>
                        <div class="floatClear"></div>
                        <div>
                            <span class="pull-left">
                                {{ form.t1bool }}
                            </span>
                            <label style="width:300px;">{{ form.xtal1T.label }}</label>
                            {{ form.xtal1T }}
                        </div>
                        <div class="floatClear"></div>
                        <div>
                            <span class="pull-left">
                                {{ form.t2bool }}
                            </span>
                            <label style="width:300px;">{{ form.xtal2T.label }}</label>
                            {{ form.xtal2T }}
                        </div>
                        <div class="floatClear"></div>
                        <div>
                            <span class="pull-left">
                                {{ form.tcbool }}
                            </span>
                            <label class="pull-left" style="width:300px;">{{ form.tempCorr.label }}</label>
                            To energy scale
                        </div>
                        <div class="floatClear"></div>
                        <div>
                            <span class="pull-left">
                                {{ form.sbool }}
                            </span>
                            <label style="width:300px;">{{ form.signal.label }}</label>
                            {{ form.signal }}
                        </div>
                        <div class="floatClear"></div>
                        <div>
                            <span class="pull-left">
                                {{ form.snbool }}
                            </span>
                            <label class="pull-left" style="width:300px;">{{ form.signalNorm.label }}</label>
                        </div>
                        <div class="floatClear"></div>
                        <div>
                            <span class="pull-left">
                                {{ form.nbool }}
                            </span>
                            <label style="width:300px;">{{ form.norm.label }}</label>
                            {{ form.norm }}
                        </div>
                        <div class="floatClear"></div>
                        <div>
                            <span class="pull-left">
                                {{ form.nfbool }}
                            </span>
                            <label style="width:300px;">{{ form.normFac.label }}</label>
                            At each data point
                        </div>
                        <div class="floatClear"></div>
                        <div>
                            <span class="pull-left">
                                {{ form.xbool }}
                            </span>
                            <label style="width:300px;">{{ form.extra.label }}</label>
                            {{ form.extra }}
                        </div>
                    </div>
                </div>
                <div class="plotLoc" id="plot_spot">
                    <div id="plot">
                        {{code|safe}}
                    </div>
                    <div class="text-center">
                        <button onclick="advance()" class="btn btn-primary btn-lg" title="Proceed with files to processing">
                            Process
                        </button>
                    </div>
                    <br/>
                    <br/>
                    <br/>
                    <br/>
                    <div class="text-center">
                        <button onclick="outputFile()" class="btn btn-primary btn-md" title="Display or save output file">
                            Output
                        </button>
                    </div>
                </div>
            </form>
            <div class="floatClear"></div>
            <div class="fitGroup">
                <div class="input-group" id="peakGroup">
                    <div class="input-group-btn">
                        <button id="fitType" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                                aria-expanded="false">Fit around max<span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a onclick="aroundMax()">Fit around max</a></li>
                            <li><a onclick="nearestPeak()">Fit around point</a></li>
                            <li><a onclick="atPoint()">Peak at point</a></li>
                        </ul>
                    </div>
                    <input type="text" id="peakLocation" class="form-control" aria-label="...">
                    <input type="text" class="form-control" id="localRange" style="display: none;">
                </div>
                <div class="peakWidth">
                        <input type="text" id="pWInput" class="form-control" aria-label="..." placeholder="Peak fit range">
                </div>
                <div class="fitMeth">
                    <button class="btn btn-default dropdown-toggle" data-toggle="dropdown" id="fitMethod" aria-haspopup="true"
                            aria-expanded="false">Centroid<span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu centMenu" id="fitMethdd">
                        <li><a>None yet implemented</a></li>
                    </ul>
                </div>
            </div>
            <div class="fitBtn">
                <button class="btn btn-primary btn-md" onclick="fitPeak(0)" title="Apply selected fitting technique to plot">
                    Fit
                </button>
            </div>
            <div class="HRM-select dropup">
                <button class="btn btn-default dropdown-toggle" data-toggle="dropdown" id="HRM" aria-haspopup="true"
                        aria-expanded="false">Fe-inline-1meV<span class="caret"></span>
                </button>
                <ul class="dropdown-menu hrmMenu" id="HRMdd">
                    <li><a>Fe-inline-1meV</a></li>
                    <li><a>Sn-nested-1meV</a></li>
                    <li><a>Eu-nested-1meV</a></li>
                    <li><a>Dy-nested-1meV</a></li>
                    <li><a>IXS-cryo-1meV</a></li>
                    <li><a>Sn-cryo-1meV</a></li>
                </ul>
            </div>
            <div class="saveSes">
                <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#ssModal" title="Save this session so that it can be accessed later">
                    Save Session
                </button>
            </div>
            <div id="shiftVal" class="shiftVal">
                {% if shiftVal is defined %}
                    Shifted:
                    {{ shiftVal }}
                {% endif %}
            </div>
        </div>
    </div>
</div>
<footer>
    <p>Copyright (c) UChicago Argonne, LLC. All rights reserved.</p>
</footer>
</body>
</html>